# [AHC036](https://atcoder.jp/contests/ahc036)

## 何をするか

- T個の都市を順に訪問する
- 訪問するために信号を制御し、信号の制御回数をなるべく少なくする

- N(=600)個の都市があり、最初は都市0におり、T(=600)個の都市を順に訪問したい(訪問する都市は重複あり。ただし連続して同じ都市に訪問はしない)
- 都市間の道路はM(N-1 <= M <= 3N-6)個あり、連結である(必ずすべての都市はつながっている)
- 都市に移動するには、移動先の信号が青の時のみ移動可能でる
- 予定した訪問先に順に訪問する際、信号の制御が可能で、信号の制御の回数をなるべく少なくしたい
- 信号の制御はLA(N <= LA <= 2N)の長さの配列AとLB(4 <= LB <= 24)の長さの配列Bを使用する
- 配列Aと配列Bから同じ長さの区間を選択して、配列Aから選択した区間を、配列Bの指定した区間で書き換える
- 配列Bで指定されている都市の信号が青となる
- 配列Aは初回に決めることができる(その後は変更不可)
- 移動と信号の制御の行動を合わせて10^5以下にする

## 理想的な解

- 一度に信号を青にできるのはLB個
- 都市間の移動は、0から開始しT個の都市を順に訪問する
- 都市間の移動は、BFSなどで最短経路を求める事ができる。最短経路の和が移動回数の最小で、LTと置く
- 理想的な制御ができたとすると、LT/LBが、信号の制御回数の最小値

## 理想的な解に近づけるために行うこと

- 都市間の移動は最短経路である方がよい。ただし信号の制御回数を抑えることができるなら、遠回りしてもよい
- 一度に信号を青にできる個数はLB個と限られており、一度に信号を青にできる対象は配列Aに依存する
- 配列Aの並びは、都市間の道路で隣接しているor近い都市を並べた方が良い

- 初期: 配列Aの並びを最適化するにはどうすればよいか
  - 移動中の方法を考える中で初期の配列Aも最適化する必要がありそう
- 移動中: => この中で初期の配列Aを最適化する？
  - 移動の経路を決定する
  - 信号を青にする対象を決定する

- 配列Aが決まったときに、最適な行動はとれるか？
- 配列Aを部分問題として最適化できるか？
  - 各都市の隣接したものを順に入れていく

## 実験

- 理想的な制御回数LT/LBを算出 => 200サンプルで平均768
- BFSなどで最短経路を算出(Done)
- 信号を青にする対象を探索 => 実装したが、配列Aが適切でないとほぼ1つずつしか青にできない

## その他気になること

- x, yはビジュアライザー用の経路がクロスしないような配置。ある程度の制約がある並びなので、最適化のヒントになるのではないか
  - 入力作成時に、x, yの距離が一定以上離れている点を採用している
  - 辺の追加時には、一定以下の距離のものを優先して採用している。一定超のものも最大値を設定して、後から採用する(数は少ないと思われる)
  - 上記の追加できる辺をすべて追加したのちに、確率で辺を除外する
  - 上記の結果でMが決まると思われるが、入力生成にMの記述はない。理論的に、N-1 <= M <= 3N-6 になるのか？

## ToDo

- 一括実行処理(Done)
- 実行結果の検証(Done)
- 配列Aをすべて使う
- 複数の経路から最適な物を選択する

## History

- v1: サンプルコードを改良し、幅優先探索で最短経路を選択(スコア: 356,812, 予測: 367,451)
- v2: 信号の制御でbを最大限使用する(スコア: 334,740, 予測: 349,674)
- v3: 配列Aを都市間の道路の隣接順に設定する(スコア: 181,773, 予測: 188,880)

## 実行コマンド

- 1テストケース実行

```
cargo build
cat .\in\0000.txt | .\target\debug\ahc036.exe > .\out\0000.txt
.\tools\vis.exe .\in\0000.txt .\out\0000.txt
```

- 一括実行

```
cargo build
python .\simulator.py
```

